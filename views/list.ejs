<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <%- include('header.ejs')%>
    <main class="grey-bg">
        <div class="white-bg">
            <% ê²Œì‹œë¬¼.forEach(function(a,i){ %>
                <div class="list-box">
                    <h4>
                        <a href="/detail/<%= ê²Œì‹œë¬¼[i]._id%>"><%= ê²Œì‹œë¬¼[i].title%></a>
                        <a href="/edit/<%= ê²Œì‹œë¬¼[i]._id%>">âœï¸</a>
                        <span class="delete" data-id="<%= ê²Œì‹œë¬¼[i]._id%>">ğŸ—‘ï¸</span>
                    </h4>
                    <p><%= ê²Œì‹œë¬¼[i].content%></p>
                 </div>
            <% }); %>
          </div> 
    </main>
</body>
<script>
//SSE ì„œë²„ì—ì„œ ë°›ê¸°
let eventSource = new EventSource('/stream/list')
eventSource.addEventListener('post',function(e){
let ê°€ì ¸ì˜¨ë°ì´í„° = JSON.parse(e.data); //ë°ì´í„°ê°€ jsoní˜•íƒœë¡œ ì™€ì„œ ë‹¤ì‹œ ì˜¤ë¸Œì íŠ¸ë¡œ ë°”ê¿”ì¤˜ì•¼í•¨
console.log(ê°€ì ¸ì˜¨ë°ì´í„°)
document.querySelector('.white-bg').insertAdjacentHTML('afterbegin',/*html*/`
<div class="list-box">
    <h4>${ê°€ì ¸ì˜¨ë°ì´í„°.title}</h4>
    <p>${ê°€ì ¸ì˜¨ë°ì´í„°.content}</p>
</div>
    `)
})

// setTimeout(() => {
    for (var i = 0; i < "<%= ê²Œì‹œë¬¼.length %>"; i++) { 
        let deleteElement = document.querySelectorAll('.delete')[i];
        if (deleteElement) { 
            deleteElement.addEventListener('click', function(e) {
                fetch('/delete?docid=' + e.target.dataset.id, {
                     method : 'DELETE',
                    })
                    e.target.parentElement.parentElement.style.display = 'none'
                    // .then(()=>{
                    //     e.target.parentElement.parentElement.style.display = 'none'
                    //     console.log('ì‚­ì œì„±ê³µ')
                    // })
                
            })
        }
    }
// }, 1000)


    
</script>
</html>